machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker

checkout:
  post:
    - git fetch --unshallow || true
    - git fetch --tags
    # GOPATH is cached, so we need to clean out the version from the previous
    # run or the subsequent `mv` will fail. We put our checkout in the correct
    # location for the OSX build step.
    - rm -rf         "${GOPATH%%:*}/src/github.com/jive/postal"
    - mkdir -p       "${GOPATH%%:*}/src/github.com/jive/"
    - mv ~/postal "${GOPATH%%:*}/src/github.com/jive/"
    - ln -s          "${GOPATH%%:*}/src/github.com/jive/postal" ~/postal
    - go get github.com/Masterminds/glide

dependencies:
  override:
    - glide install

test:
  override:
    - go test -v $(glide novendor)
